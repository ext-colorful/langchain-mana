# ğŸš€ ä¼ä¸šçº§ AI æ™ºèƒ½ä½“å¹³å°

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€é«˜åº¦å¯æ‰©å±•çš„ä¼ä¸šçº§ AI æ™ºèƒ½ä½“å¹³å°ï¼Œæ”¯æŒå¤šæ¨¡å‹ã€RAG çŸ¥è¯†åº“ã€å·¥å…·é›†æˆå’Œæµå¼è¾“å‡ºã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. **å¤šæ™ºèƒ½ä½“è¿è¡Œæ—¶ï¼ˆAgent Runtimeï¼‰**
- âœ… å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œ
- âœ… ä»»åŠ¡å–æ¶ˆï¼ˆCancellation Tokenï¼‰
- âœ… æµå¼è¾“å‡º
- âœ… é”™è¯¯å¤„ç†ä¸é‡è¯•
- âœ… å·¥å…·è°ƒç”¨ä¸ RAG é›†æˆ

### 2. **å¤šæ¨¡å‹æ”¯æŒä¸æ™ºèƒ½è·¯ç”±**
- âœ… OpenAI (GPT-4, GPT-3.5)
- âœ… DeepSeek (deepseek-chat, deepseek-coder)
- âœ… Qwen (qwen-turbo, qwen-plus, qwen-max)
- âœ… Anthropic (Claude 3 ç³»åˆ—)
- âœ… æ™ºèƒ½è·¯ç”±ç­–ç•¥ï¼šæˆæœ¬ä¼˜åŒ–ã€é€Ÿåº¦ä¼˜åŒ–ã€è´¨é‡ä¼˜åŒ–

### 3. **RAG çŸ¥è¯†åº“ç³»ç»Ÿ**
- âœ… æ–‡ä»¶ä¸Šä¼ ä¸è§£æï¼ˆPDFã€Wordã€Markdownã€HTMLã€TXTï¼‰
- âœ… æ™ºèƒ½æ–‡æœ¬åˆ‡åˆ†ï¼ˆChunkingï¼‰
- âœ… å‘é‡åŒ–ä¸æ£€ç´¢ï¼ˆåŸºäº ChromaDBï¼‰
- âœ… å‘½åç©ºé—´éš”ç¦»
- âœ… ç›¸ä¼¼åº¦æ£€ç´¢ä¸ Top-K

### 4. **å·¥å…·æ³¨å†Œä¸­å¿ƒï¼ˆTool Registryï¼‰**
- âœ… å†…ç½®å·¥å…·ï¼šè®¡ç®—å™¨ã€å¤©æ°”æŸ¥è¯¢
- âœ… åŠ¨æ€å·¥å…·æ³¨å†Œ
- âœ… æƒé™æ§åˆ¶
- âœ… å¯æ‰©å±•æ¶æ„

### 5. **ä¼ä¸šçº§åŠŸèƒ½**
- âœ… PostgreSQL å…ƒæ•°æ®å­˜å‚¨
- âœ… JWT è®¤è¯
- âœ… API å®¡è®¡æ—¥å¿—
- âœ… å¥åº·æ£€æŸ¥
- âœ… ç›‘æ§æŒ‡æ ‡
- âœ… Docker éƒ¨ç½²

---

## ğŸ“‹ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FastAPI Gateway                        â”‚
â”‚  [Authentication] [Rate Limit] [Audit] [Monitoring]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Agent Runtime  â”‚ â”‚   Model   â”‚ â”‚ RAG Pipeline  â”‚
â”‚                â”‚ â”‚  Router   â”‚ â”‚               â”‚
â”‚ â€¢ Executor     â”‚ â”‚           â”‚ â”‚ â€¢ Parser      â”‚
â”‚ â€¢ Context      â”‚ â”‚ â€¢ OpenAI  â”‚ â”‚ â€¢ Chunking    â”‚
â”‚ â€¢ Streaming    â”‚ â”‚ â€¢ DeepSeekâ”‚ â”‚ â€¢ Embedding   â”‚
â”‚ â€¢ Cancellation â”‚ â”‚ â€¢ Qwen    â”‚ â”‚ â€¢ Retrieval   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â€¢ Claude  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
         â”‚                               â”‚
         â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
         â””â”€â”€â”€â”€â–ºâ”‚Tool Registry â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚              â”‚
               â”‚ â€¢ Calculator â”‚
               â”‚ â€¢ Weather    â”‚
               â”‚ â€¢ Custom     â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
â”‚ PostgreSQL â”‚ â”‚  ChromaDB  â”‚ â”‚  Storage â”‚
â”‚            â”‚ â”‚            â”‚ â”‚          â”‚
â”‚ â€¢ Users    â”‚ â”‚ â€¢ Vectors  â”‚ â”‚ â€¢ Files  â”‚
â”‚ â€¢ Agents   â”‚ â”‚ â€¢ Metadata â”‚ â”‚          â”‚
â”‚ â€¢ Sessions â”‚ â”‚            â”‚ â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

è¯¦ç»†æ¶æ„æ–‡æ¡£ï¼š[docs/architecture/SYSTEM_ARCHITECTURE.md](docs/architecture/SYSTEM_ARCHITECTURE.md)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚
- Docker & Docker Compose
- Python 3.10+ (æœ¬åœ°å¼€å‘)
- PostgreSQL 15+
- è‡³å°‘ä¸€ä¸ª LLM API Key

### 1. å…‹éš†é¡¹ç›®å¹¶é…ç½®ç¯å¢ƒ

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Keys
# è‡³å°‘éœ€è¦é…ç½®ä¸€ä¸ªæ¨¡å‹æä¾›å•†çš„ API Key
vim .env
```

### 2. ä½¿ç”¨ Docker Compose å¯åŠ¨

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡ï¼ˆPostgreSQL + ChromaDB + Backendï¼‰
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f backend

# åœæ­¢æœåŠ¡
docker-compose down
```

### 3. éªŒè¯æœåŠ¡

```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# API æ–‡æ¡£
open http://localhost:8000/docs
```

---

## ğŸ“– API ä½¿ç”¨ç¤ºä¾‹

### 1. åˆ›å»º Agent

```bash
curl -X POST "http://localhost:8000/api/v1/agents/create" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "name": "My First Agent",
    "description": "A helpful assistant with calculator tool",
    "model_provider": "openai",
    "model_name": "gpt-3.5-turbo",
    "temperature": 0.7,
    "system_prompt": "You are a helpful AI assistant.",
    "tools": ["calculator"],
    "rag_enabled": false
  }'
```

### 2. è¿è¡Œ Agent

```bash
curl -X POST "http://localhost:8000/api/v1/agents/1/run" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "message": "What is 123 * 456?"
  }'
```

### 3. åˆ›å»ºçŸ¥è¯†åº“

```bash
curl -X POST "http://localhost:8000/api/v1/knowledge/create" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "name": "My Knowledge Base",
    "description": "Company documents",
    "chunk_size": 1000,
    "chunk_overlap": 200
  }'
```

### 4. ä¸Šä¼ æ–‡ä»¶åˆ°çŸ¥è¯†åº“

```bash
curl -X POST "http://localhost:8000/api/v1/knowledge/1/upload" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@document.pdf"
```

### 5. æŸ¥è¯¢çŸ¥è¯†åº“

```bash
curl -X POST "http://localhost:8000/api/v1/knowledge/query" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "query": "What are the company policies?",
    "knowledge_base_ids": [1],
    "top_k": 5
  }'
```

### 6. åˆ—å‡ºå¯ç”¨æ¨¡å‹

```bash
curl -X GET "http://localhost:8000/api/v1/models/list" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 7. åˆ—å‡ºå¯ç”¨å·¥å…·

```bash
curl -X GET "http://localhost:8000/api/v1/tools/list" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

---

## ğŸ§ª æµ‹è¯•

```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-asyncio

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cd backend
pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
pytest tests/test_tools.py -v
pytest tests/test_agent_runtime.py -v
```

---

## ğŸ”§ æœ¬åœ°å¼€å‘

### å®‰è£…ä¾èµ–

```bash
cd backend
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows

pip install -r requirements.txt
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# ç¡®ä¿ PostgreSQL å’Œ ChromaDB å·²å¯åŠ¨
docker-compose up -d postgres chroma

# å¯åŠ¨ FastAPI
uvicorn main:app --reload --port 8000
```

### æ•°æ®åº“è¿ç§»ï¼ˆAlembicï¼‰

```bash
# åˆå§‹åŒ– Alembic
alembic init alembic

# ç”Ÿæˆè¿ç§»
alembic revision --autogenerate -m "Initial migration"

# æ‰§è¡Œè¿ç§»
alembic upgrade head
```

---

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/v1/              # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ agents.py        # Agent CRUD & è¿è¡Œ
â”‚   â”‚   â”œâ”€â”€ knowledge.py     # çŸ¥è¯†åº“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ models.py        # æ¨¡å‹åˆ—è¡¨
â”‚   â”‚   â””â”€â”€ tools.py         # å·¥å…·åˆ—è¡¨
â”‚   â”œâ”€â”€ agents/              # Agent Runtime
â”‚   â”‚   â””â”€â”€ runtime.py       # æ‰§è¡Œå¼•æ“
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ config.py        # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database.py      # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â””â”€â”€ security.py      # è®¤è¯ä¸æˆæƒ
â”‚   â”œâ”€â”€ models/              # Model Router
â”‚   â”‚   â””â”€â”€ router.py        # æ¨¡å‹è·¯ç”±å™¨
â”‚   â”œâ”€â”€ rag/                 # RAG Pipeline
â”‚   â”‚   â”œâ”€â”€ pipeline.py      # RAG ç®¡é“
â”‚   â”‚   â””â”€â”€ parsers/         # æ–‡ä»¶è§£æå™¨
â”‚   â”œâ”€â”€ storage/             # å­˜å‚¨å±‚
â”‚   â”‚   â”œâ”€â”€ models.py        # SQLAlchemy æ¨¡å‹
â”‚   â”‚   â””â”€â”€ chroma_db.py     # ChromaDB ç®¡ç†
â”‚   â”œâ”€â”€ tools/               # Tool Registry
â”‚   â”‚   â”œâ”€â”€ base.py          # å·¥å…·åŸºç±»
â”‚   â”‚   â””â”€â”€ builtin/         # å†…ç½®å·¥å…·
â”‚   â”œâ”€â”€ schemas/             # Pydantic Schemas
â”‚   â””â”€â”€ utils/               # å·¥å…·å‡½æ•°
â”œâ”€â”€ tests/                   # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ main.py                  # åº”ç”¨å…¥å£
â”œâ”€â”€ requirements.txt         # Python ä¾èµ–
â””â”€â”€ Dockerfile               # Docker é•œåƒ

docs/
â””â”€â”€ architecture/
    â””â”€â”€ SYSTEM_ARCHITECTURE.md  # ç³»ç»Ÿæ¶æ„æ–‡æ¡£

docker-compose.yml           # Docker Compose é…ç½®
.env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
```

---

## ğŸ”Œ æ‰©å±•å¼€å‘

### æ·»åŠ è‡ªå®šä¹‰å·¥å…·

```python
# backend/app/tools/builtin/my_tool.py
from ..base import BaseTool, ToolMetadata, ToolParameter
from typing import Any

class MyCustomTool(BaseTool):
    @property
    def metadata(self) -> ToolMetadata:
        return ToolMetadata(
            name="my_tool",
            description="My custom tool description",
            parameters=[
                ToolParameter(
                    name="param1",
                    type="string",
                    description="Parameter description",
                    required=True
                )
            ],
            category="custom"
        )
    
    async def execute(self, param1: str) -> Any:
        # å®ç°ä½ çš„å·¥å…·é€»è¾‘
        return {"result": f"Processed: {param1}"}

# åœ¨ app/tools/__init__.py ä¸­æ³¨å†Œ
from .builtin.my_tool import MyCustomTool

def register_builtin_tools():
    tool_registry.register(CalculatorTool())
    tool_registry.register(WeatherTool())
    tool_registry.register(MyCustomTool())  # æ·»åŠ ä½ çš„å·¥å…·
```

### æ·»åŠ æ–°çš„æ–‡ä»¶è§£æå™¨

```python
# backend/app/rag/parsers/custom_parser.py
from .base import BaseParser
from langchain_core.documents import Document
from typing import List

class CustomParser(BaseParser):
    @property
    def supported_extensions(self) -> List[str]:
        return [".custom"]
    
    async def parse(self, file_path: str, metadata: dict = None) -> List[Document]:
        # å®ç°è§£æé€»è¾‘
        content = "Parsed content"
        return [Document(page_content=content, metadata=metadata or {})]
```

### æ·»åŠ æ–°çš„æ¨¡å‹æä¾›å•†

```python
# åœ¨ backend/app/core/config.py ä¸­æ·»åŠ é…ç½®
class ModelProviderConfig:
    PROVIDERS = {
        # ... ç°æœ‰é…ç½® ...
        "my_provider": {
            "api_key": settings.MY_PROVIDER_API_KEY,
            "base_url": settings.MY_PROVIDER_BASE_URL,
            "models": ["model-1", "model-2"],
            "default": "model-1"
        }
    }

# åœ¨ backend/app/models/router.py ä¸­å®ç°é€‚é…å™¨
def _create_model(self, provider: str, model_name: str, ...):
    # ... ç°æœ‰ä»£ç  ...
    elif provider == "my_provider":
        from langchain_myprovider import ChatMyProvider
        return ChatMyProvider(...)
```

---

## ğŸ“Š ç›‘æ§ä¸è¿ç»´

### å¥åº·æ£€æŸ¥

```bash
GET /health
```

è¿”å›ï¼š
```json
{
  "status": "healthy",
  "database": "ok",
  "chroma": "ok",
  "models": ["openai", "deepseek", "qwen"]
}
```

### æŒ‡æ ‡ç›‘æ§

```bash
GET /metrics
```

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### 1. ChromaDB è¿æ¥å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿ ChromaDB æœåŠ¡å·²å¯åŠ¨ï¼Œæ£€æŸ¥ `CHROMA_HOST` å’Œ `CHROMA_PORT` é…ç½®ã€‚

### 2. æ¨¡å‹è°ƒç”¨å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®é…ç½®ï¼Œç½‘ç»œæ˜¯å¦å¯è®¿é—®æ¨¡å‹æä¾›å•† APIã€‚

### 3. æ–‡ä»¶ä¸Šä¼ åå¤„ç†å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒï¼ŒæŸ¥çœ‹åå°æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯ã€‚

### 4. æ•°æ®åº“è¿æ¥é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼šç¡®ä¿ PostgreSQL å·²å¯åŠ¨ï¼Œæ£€æŸ¥æ•°æ®åº“é…ç½®å’Œæƒé™ã€‚

---

## ğŸ—ºï¸ åç»­æ‰©å±•å»ºè®®

### çŸ­æœŸï¼ˆ1-2 å‘¨ï¼‰
- [ ] æ·»åŠ ç”¨æˆ·æ³¨å†Œå’Œç™»å½•æ¥å£
- [ ] å®ç° WebSocket æµå¼è¾“å‡º
- [ ] æ·»åŠ æ›´å¤šå†…ç½®å·¥å…·ï¼ˆæœç´¢ã€é‚®ä»¶ç­‰ï¼‰
- [ ] å®Œå–„å•å…ƒæµ‹è¯•è¦†ç›–ç‡

### ä¸­æœŸï¼ˆ1-2 æœˆï¼‰
- [ ] å‰ç«¯ UI å¼€å‘ï¼ˆReact + Next.jsï¼‰
- [ ] Agent é…ç½®å¯è§†åŒ–ç¼–è¾‘å™¨
- [ ] RAG æŸ¥è¯¢ç»“æœå¯è§†åŒ–
- [ ] å¤šç§Ÿæˆ·æ”¯æŒ
- [ ] æˆæœ¬è¿½è¸ªä¸é…é¢ç®¡ç†

### é•¿æœŸï¼ˆ3-6 æœˆï¼‰
- [ ] å¤š Agent åä½œæ¡†æ¶
- [ ] Workflow å¯è§†åŒ–ç¼–æ’
- [ ] æ’ä»¶å¸‚åœº
- [ ] ä¼ä¸šçº§æƒé™ç®¡ç†ï¼ˆRBACï¼‰
- [ ] Kubernetes éƒ¨ç½²æ”¯æŒ
- [ ] è‡ªåŠ¨åŒ–æµ‹è¯•ä¸ CI/CD

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

---

## ğŸ™ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

## ğŸ“§ è”ç³»æ–¹å¼

- é¡¹ç›®ä¸»é¡µï¼šhttps://github.com/your-org/ai-agent-platform
- æŠ€æœ¯æ”¯æŒï¼šsupport@your-domain.com
- æ–‡æ¡£ä¸­å¿ƒï¼šhttps://docs.your-domain.com

---

**å¿«é€Ÿå¼€å§‹ç¤ºä¾‹å·²åŒ…å«åœ¨ `examples/` ç›®å½•ä¸­ï¼** ğŸ‰
